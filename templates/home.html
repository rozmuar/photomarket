{% extends 'base.html' %}
{% load static %}

{% block title %}PhotoMarket - Найди себя на фото{% endblock %}

{% block content %}
<!-- Hero Section -->
<section class="hero-section">
    <div class="container">
        <div class="row align-items-center g-5">
            <div class="col-lg-6">
                <div class="hero-content">
                    <h1>
                        Найди, <span class="text-accent">Купи</span> &<br>
                        Продай Фотографии<br>
                        с Мероприятий
                    </h1>
                    <p>
                        Загрузи своё селфи и система автоматически найдёт 
                        все профессиональные фотографии с твоим лицом 
                        на мероприятиях и событиях.
                    </p>
                    <div class="hero-buttons">
                        <a href="{% url 'accounts:register' %}" class="btn btn-accent">
                            <i class="bi bi-person-plus"></i> Найти фото
                        </a>
                        <a href="{% url 'photos:gallery' %}" class="btn btn-outline-accent">
                            <i class="bi bi-images"></i> Смотреть галерею
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-lg-6">
                <div class="hero-image-card" id="heroSlider">
                    <div class="hero-nav-arrows">
                        <button onclick="prevSlide()"><i class="bi bi-chevron-left"></i></button>
                        <button onclick="nextSlide()"><i class="bi bi-chevron-right"></i></button>
                    </div>
                    {% if featured_photos %}
                        <img src="{{ featured_photos.0.watermarked.url }}" alt="Featured photo" id="heroImage">
                        <div class="hero-image-info">
                            <img src="{% if featured_photos.0.photographer.avatar %}{{ featured_photos.0.photographer.avatar.url }}{% else %}https://ui-avatars.com/api/?name={{ featured_photos.0.photographer.user.username }}&background=0099cc&color=fff{% endif %}" 
                                 alt="Avatar" class="avatar">
                            <div class="info">
                                <h6 id="heroTitle">{{ featured_photos.0.title|default:"Фото с мероприятия" }}</h6>
                                <span>Автор: <a href="#">{{ featured_photos.0.photographer.user.get_full_name|default:featured_photos.0.photographer.user.username }}</a></span>
                            </div>
                        </div>
                    {% else %}
                        <img src="https://images.unsplash.com/photo-1492684223066-81342ee5ff30?w=600" alt="Event photo">
                        <div class="hero-image-info">
                            <img src="https://ui-avatars.com/api/?name=PM&background=0099cc&color=fff" alt="Avatar" class="avatar">
                            <div class="info">
                                <h6>Фотографии с мероприятий</h6>
                                <span>Найди себя на фото!</span>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Live Photos Section -->
<section class="py-5">
    <div class="container">
        <div class="section-header">
            <div>
                <span class="section-label">Свежие</span>
                <h2 class="section-title">Последние фотографии</h2>
            </div>
            <a href="{% url 'photos:gallery' %}" class="section-link">
                Смотреть все <i class="bi bi-arrow-right"></i>
            </a>
        </div>
        
        <div class="row g-4">
            {% for photo in latest_photos %}
            <div class="col-lg-4 col-md-6">
                <a href="{% url 'clients:photo_detail' photo.id %}" class="text-decoration-none">
                    <div class="photo-card">
                        <div class="photo-card-image">
                            <img src="{% if photo.watermarked %}{{ photo.watermarked.url }}{% else %}{{ photo.original.url }}{% endif %}" 
                                 alt="{{ photo.title }}">
                            {% if photo.event %}
                            <span class="photo-card-badge">
                                <i class="bi bi-calendar-event"></i> {{ photo.event.name|truncatechars:20 }}
                            </span>
                            {% endif %}
                        </div>
                        <div class="photo-card-meta">
                            <div class="photo-card-author">
                                <img src="{% if photo.photographer.avatar %}{{ photo.photographer.avatar.url }}{% else %}https://ui-avatars.com/api/?name={{ photo.photographer.user.username }}&background=0099cc&color=fff&size=35{% endif %}" 
                                     alt="Avatar">
                                <span>{{ photo.photographer.user.get_full_name|default:photo.photographer.user.username }}</span>
                            </div>
                            <div class="photo-card-likes">
                                <i class="bi bi-heart"></i>
                                <span>{{ photo.views_count|default:0 }}</span>
                            </div>
                        </div>
                        <div class="photo-card-body">
                            <h5 class="photo-card-title">{{ photo.title|default:"Фото с мероприятия" }}</h5>
                            <div class="photo-card-price">
                                <span class="label">Цена</span>
                                <span class="value">{{ photo.price }} ₽</span>
                            </div>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <i class="bi bi-images display-1 text-muted"></i>
                <p class="text-muted mt-3">Фотографии скоро появятся</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- Top Photographers Section -->
<section class="py-5">
    <div class="container">
        <div class="section-header">
            <div>
                <span class="section-label">Топ авторы</span>
                <h2 class="section-title">Лучшие фотографы</h2>
            </div>
            <a href="#" class="section-link">
                Все фотографы <i class="bi bi-arrow-right"></i>
            </a>
        </div>
        
        <div class="row g-4">
            {% for photographer in top_photographers %}
            <div class="col-lg-3 col-md-6">
                <div class="photographer-card">
                    <img src="{% if photographer.avatar %}{{ photographer.avatar.url }}{% else %}https://ui-avatars.com/api/?name={{ photographer.user.username }}&background=0099cc&color=fff&size=60{% endif %}" 
                         alt="Avatar" class="avatar">
                    <div class="info">
                        <h5>{{ photographer.user.get_full_name|default:photographer.user.username }}</h5>
                        <span>{{ photographer.photos_count|default:0 }} фото</span>
                    </div>
                </div>
            </div>
            {% empty %}
            <!-- Placeholder cards -->
            <div class="col-lg-3 col-md-6">
                <div class="photographer-card">
                    <img src="https://ui-avatars.com/api/?name=PM&background=0099cc&color=fff&size=60" alt="Avatar" class="avatar">
                    <div class="info">
                        <h5>Станьте первым</h5>
                        <span>Начните публиковать</span>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- How It Works Section -->
<section class="py-5">
    <div class="container">
        <div class="section-header">
            <div>
                <span class="section-label">Как это работает</span>
                <h2 class="section-title">Найди себя на фото за 4 шага</h2>
            </div>
        </div>
        
        <div class="row g-4">
            <div class="col-lg-3 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-person-plus"></i>
                    </div>
                    <h4>Регистрация</h4>
                    <p>Создайте аккаунт клиента за пару минут. Это бесплатно и быстро.</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-camera"></i>
                    </div>
                    <h4>Загрузите селфи</h4>
                    <p>Сделайте чёткое фото своего лица. Система использует его для поиска.</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-search"></i>
                    </div>
                    <h4>Автопоиск</h4>
                    <p>AI автоматически найдёт все фотографии с вашим лицом среди тысяч снимков.</p>
                </div>
            </div>
            <div class="col-lg-3 col-md-6">
                <div class="feature-card">
                    <div class="feature-icon">
                        <i class="bi bi-download"></i>
                    </div>
                    <h4>Скачайте оригинал</h4>
                    <p>Купите понравившиеся фото и получите их в полном разрешении без водяных знаков.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Latest Events Section -->
<section class="py-5">
    <div class="container">
        <div class="section-header">
            <div>
                <span class="section-label">Мероприятия</span>
                <h2 class="section-title">Последние события</h2>
            </div>
            <a href="{% url 'photos:events' %}" class="section-link">
                Все события <i class="bi bi-arrow-right"></i>
            </a>
        </div>
        
        <div class="row g-4">
            {% for event in latest_events %}
            <div class="col-lg-4 col-md-6">
                <a href="{% url 'photos:event_detail' event.id %}" class="text-decoration-none">
                    <div class="event-card">
                        <div class="event-card-image">
                            {% if event.cover_image %}
                            <img src="{{ event.cover_image.url }}" alt="{{ event.name }}">
                            {% else %}
                            <img src="https://images.unsplash.com/photo-1540575467063-178a50c2df87?w=400" alt="Event">
                            {% endif %}
                        </div>
                        <div class="event-card-body">
                            <div class="event-card-date">
                                <i class="bi bi-calendar"></i> {{ event.date|date:"d.m.Y" }} | 
                                <i class="bi bi-person"></i> {{ event.photographer.user.username }}
                            </div>
                            <h5 class="event-card-title">{{ event.name }}</h5>
                            <p class="event-card-desc">{{ event.description|truncatechars:80 }}</p>
                            <span class="event-card-link">
                                Смотреть фото <i class="bi bi-chevron-right"></i>
                            </span>
                        </div>
                    </div>
                </a>
            </div>
            {% empty %}
            <div class="col-12 text-center py-5">
                <i class="bi bi-calendar-x display-1 text-muted"></i>
                <p class="text-muted mt-3">События скоро появятся</p>
            </div>
            {% endfor %}
        </div>
    </div>
</section>

<!-- CTA Section -->
<section class="py-5">
    <div class="container">
        <div class="card-dark text-center py-5">
            <div class="card-body">
                <h2 class="mb-3">Готовы найти себя на фото?</h2>
                <p class="text-muted mb-4">Присоединяйтесь к тысячам пользователей, которые уже нашли свои лучшие моменты</p>
                <div class="d-flex justify-content-center gap-3 flex-wrap">
                    <a href="{% url 'accounts:register' %}?type=client" class="btn btn-accent btn-lg">
                        <i class="bi bi-person-plus"></i> Я ищу фото
                    </a>
                    <a href="{% url 'accounts:register' %}?type=photographer" class="btn btn-outline-accent btn-lg">
                        <i class="bi bi-camera"></i> Я фотограф
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
// Simple hero slider (if photos exist)
const heroPhotos = [
    {% for photo in featured_photos %}
    {
        image: "{% if photo.watermarked %}{{ photo.watermarked.url }}{% else %}{{ photo.original.url }}{% endif %}",
        title: "{{ photo.title|default:'Фото с мероприятия' }}",
        author: "{{ photo.photographer.user.get_full_name|default:photo.photographer.user.username }}"
    }{% if not forloop.last %},{% endif %}
    {% endfor %}
];

let currentSlide = 0;

function updateSlide() {
    if (heroPhotos.length === 0) return;
    const img = document.getElementById('heroImage');
    const title = document.getElementById('heroTitle');
    if (img && title) {
        img.src = heroPhotos[currentSlide].image;
        title.textContent = heroPhotos[currentSlide].title;
    }
}

function nextSlide() {
    if (heroPhotos.length === 0) return;
    currentSlide = (currentSlide + 1) % heroPhotos.length;
    updateSlide();
}

function prevSlide() {
    if (heroPhotos.length === 0) return;
    currentSlide = (currentSlide - 1 + heroPhotos.length) % heroPhotos.length;
    updateSlide();
}

// Auto-slide every 5 seconds
setInterval(nextSlide, 5000);
</script>
{% endblock %}
